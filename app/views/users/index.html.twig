{% extends('default.html.twig') %}

{% import 'includes/permissions.inc.twig' as macros %}
{% block content %}
    <div class="container pt-3">
        <h1>Profil uživatele</h1>
        <form action="{{ constant('URLROOT') }}/users/updateUserUsernameEmail/{{ session.user.id }}" method="POST">
            <div class="table-responsive">
            <table class="table table-striped">
                <tr>
                    <th>Typ informace</th>
                    <th>Hodnota</th>
                </tr>
                <tr>
                   <td>Jméno:</td>
                    <td><input class="form-control" type="text" id="username" placeholder="Uživatelské jméno *" name="username" value="{{ session.user.username }}">
                        <span class="invalidFeedBack">{{ usernameError }}</span>
                    </td>
                </tr>
                <tr>
                    <td>Email:</td>
                    <td><input class="form-control" id="email" type="email" placeholder="Email *" name="email" value="{{ session.user.email }}">
                        <span class="invalidFeedBack">{{ emailError }}</span>
                    </td>
                </tr>

                <tr>
                    <td>Heslo:</td>
                    <td><a href="{{ constant('URLROOT') }}/users/changePassword/{{ session.user.id }}">Změnit heslo</a> </td>
                </tr>
                <tr>
                    <td>role: </td>
                    <td>{{ session.user.role }}</td>
                </tr>
            </table>
            </div>
            <button class="myBtn btn btn-primary" id="registerButton" type="submit" value="submit">Změnit údaje</button>
        </form>

        {% if userPosts is not empty %}
        <h3 class="mt-3">Příspěvky</h3>
        <div class="table-responsive">
            <table class="table table-striped">
            <thead>
            <tr>
                <th scope="col">Titulek</th>
                <th scope="col">Popis</th>
            </tr>
            </thead>
            {% for post in userPosts %}
                <tbody>
                <td><a href="{{ constant('URLROOT') }}/posts/show/{{ post.id }}">{{ post.title }}</a></td>
                <td class="tableCellLongText">{{ post.description }}</td>
                {% if session.user is not empty and session.user.id == post.user_id %}
                    <!--
                    <td>
                        <a class="myBtn btn orange ms-3 float-end"
                           href="{{ constant('URLROOT')}}/posts/update/{{ post.id}}">
                            Upravit
                        </a>
                    </td>
                    <td>
                        <form action="{{ constant('URLROOT')}}/posts/delete/{{ post.id}}" method="POST" class="delete-form">
                            <button class="myBtn btn btn-danger float-end ms-2" name="submit" type="submit">Smazat</button>
                        </form>
                    </td>
                    -->
                    <td>
                        {{ macros.canUpdateDeletePost(post)}}
                    </td>
                {% endif %}
            {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        <!-- reviews -->

        {% if userReviews is not empty %}
        <h3 class="mt-3">Recenze</h3>
        <div class="reviews table-responsive">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th scope="col">Nadpis článku</th>
                    <th scope="col">Kvalita tématu</th>
                    <th scope="col">Jazyk</th>
                    <th scope="col">Originalita</th>
                    <th scope="col">Poznámky</th>
                </tr>
                </thead>
                <tbody>
                {% for review in userReviews %}
                    <tr>
                        <td><a href="{{ constant('URLROOT') }}/posts/show/{{ review.post.id }}">{{ review.post.title }}</a></td>
                        <td>{% for i in 1..review.topicRelevance %}
                                <i class="star fas fa-star"></i>
                            {% endfor %}</td>
                        <td>{% for i in 1..review.langQuality %}
                                <i class="star fas fa-star"></i>
                            {% endfor %}</td>
                        <td>{% for i in 1..review.originality %}
                                <i class="star fas fa-star"></i>
                            {% endfor %}</td>
                        <td class="tableCellLongText">{{ review.notes  | raw }}</td>
                        {% if session.user is not empty  %}
                            <td>
                                {{ macros.canUpdateReview(review) }}
                            </td>
                            <td>
                                {{ macros.canDeleteReview(review) }}
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
{% endblock %}